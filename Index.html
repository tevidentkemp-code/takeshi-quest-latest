<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1">&lt;meta charset="utf-8" /&gt;</p>
<p class="p1">&lt;meta name="viewport" content="width=device-width, initial-scale=1" /&gt;</p>
<p class="p1">&lt;title&gt;Shateki Quest Scorer&lt;/title&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;!-- Supabase JS v2 --&gt;</p>
<p class="p1">&lt;script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"&gt;&lt;/script&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>--bg:#0f1220;--card:#171a2b;--ink:#e7e9f5;--muted:#a8acc3;--accent:#7bdcff;--accent-2:#8cff9e;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>--danger:#ff6b6b;--warn:#ffcc66;--good:#7fffd4;--shadow:0 10px 30px rgba(0,0,0,.35);--radius:14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>--pad-h:148px; --left-col-w:96px; --start-btn-h:52px;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>*{box-sizing:border-box}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>html,body{height:100%}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>body{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>margin:0; min-height:100dvh; overflow-x:hidden;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial,"Apple Color Emoji","Segoe UI Emoji";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>background:radial-gradient(1000px 600px at 0% 0%,#1b1f36 0%,#0f1220 45%,#0b0e1a 100%); color:var(--ink);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>-webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â </span>.wrap{max-width:1100px;margin-inline:auto;padding:16px; padding-bottom:calc(var(--pad-h) + 16px)}</p>
<p class="p1">.start-actions{</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>display:flex;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>flex-direction:column;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>align-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>margin:0 auto;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>text-align:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>max-width:480px;<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">.start-actions .btn.big{</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>width:100%;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">.section{</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>margin:14px 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>padding:14px;</p>
<p class="p1">}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.column{display:flex;flex-direction:column;gap:10px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.grow{flex:1}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.hidden{display:none!important}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.tag{font-size:.78rem;color:var(--muted);padding:.15rem .45rem;border:1px solid #2b3050;border-radius:999px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.banner{background:linear-gradient(180deg,#14284a,#12213d);border:1px solid #2a4777;border-radius:12px;padding:12px;margin-top:10px}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>input[type="text"],select,input[type="password"]{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>background:#101329;border:1px solid #2b3050;color:var(--ink);padding:.65rem .8rem;border-radius:10px;outline:none;width:100%</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.btn{appearance:none;border:1px solid #2b3050;border-radius:12px;background:#131733;color:var(--ink);</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  Â  </span>padding:.7rem 1rem;cursor:pointer;transition:.15s transform,.15s background,.15s border-color,.15s opacity;font-weight:700}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.btn:hover{transform:translateY(-1px);background:#161a3a}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.btn:disabled{opacity:.55;cursor:not-allowed;transform:none}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.btn.primary{background:linear-gradient(180deg,#1d255a,#19214f);border-color:#32407a}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.btn.good{background:linear-gradient(180deg,#1b3d2e,#183628);border-color:#2e6a4f}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.btn.warn{background:linear-gradient(180deg,#3a3219,#2f2914);border-color:#6b5821}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.btn.danger{background:linear-gradient(180deg,#47212a,#3c1b23);border-color:#7a2e3f}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.btn.big{font-size:1.15rem;padding:1rem 1.25rem;border-radius:14px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.btn.small { padding: 4px 8px; font-size: 0.8rem; min-width: 30px; min-height: 24px; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Tables */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.table-wrap{overflow:auto;border-radius:12px;border:1px solid #2a2e48}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>table{width:100%;border-collapse:separate;border-spacing:0;background:#0f1329;table-layout:fixed}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead th{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>background:#14183a;border-bottom:1px solid #2a2e48;padding:.6rem .5rem;text-align:left;font-weight:700;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>position:sticky; top:0; z-index:5;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>#scoreWrap thead th:first-child{width:var(--left-col-w);min-width:var(--left-col-w);max-width:var(--left-col-w)}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>#scoreWrap tbody th{width:var(--left-col-w);min-width:var(--left-col-w);max-width:var(--left-col-w);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:6px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead th.player, tbody td.player{min-width:120px; text-align:center}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>tbody td,tbody th{padding:.55rem .5rem;border-bottom:1px dashed #23284a;text-align:left;vertical-align:middle}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>tbody td{white-space:nowrap; overflow:hidden; text-overflow:clip}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>tbody tr:last-child td{border-bottom:none}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>tbody th{font-weight:600;color:#cfd3ee;background:#101533;border-right:1px solid #22264a}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.num{font-variant-numeric:tabular-nums}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.center{text-align:center}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.current-cell{background:linear-gradient(180deg,#1e2450,#171d45)!important;box-shadow:inset 0 0 0 1px #4050a7}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.current-col{background:rgba(64,80,167,.07)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Header content */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead th .th-wrap{display:flex;flex-direction:column;align-items:center;gap:2px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead th .th-name{font-weight:800;letter-spacing:.02em}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead th .th-beers{font-size:12px;line-height:1;min-height:14px;letter-spacing:.5px;filter:drop-shadow(0 0 6px rgba(255,204,102,.35)); text-align:center}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.th-throw-arrow{font-size:13px; line-height:1}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.th-total{font-weight:800;letter-spacing:.02em}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.th-diff{font-size:10px; line-height:1; font-weight:400 !important; color:var(--muted); text-align:center}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.th-diff-label{font-size:11px; font-weight:400 !important; color:var(--muted)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Score cell */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.cell-wrap{display:inline-flex;flex-direction:column;align-items:center;gap:1px;line-height:1}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.cell-main{font-weight:800;line-height:1.1}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.cell-sub{color:var(--muted);font-size:.60em;font-weight:500;opacity:.95;letter-spacing:-0.01em;line-height:1}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.sub-win{color:var(--accent-2)!important;font-weight:700}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Stats (kept for layout sync; shown via modals) */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.stats-box{display:none}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>#statsWrap thead th:first-child,</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>#mstatsWrap thead th:first-child{width:var(--left-col-w);min-width:var(--left-col-w);max-width:var(--left-col-w)}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>#statsWrap tbody th.stats-th,</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>#mstatsWrap tbody th.stats-th{width:var(--left-col-w);min-width:var(--left-col-w);max-width:var(--left-col-w);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:8px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.stats-th{background:#101533;color:#cfd3ee}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.stats-row th,.stats-row td{font-size:.86rem;line-height:1.15;padding:.45rem .5rem}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.stats-row td{color:#e1e4fb}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Floating names header */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.float-head{position:sticky; top:0; z-index:200000;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>background:rgba(17,19,38,.96); backdrop-filter:blur(6px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>border:1px solid #2a2e48; border-radius:12px; margin-bottom:10px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.float-head .table-wrap{border:none;border-radius:12px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>#floatWrap thead th:first-child{width:var(--left-col-w);min-width:var(--left-col-w);max-width:var(--left-col-w)}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Hide Throw Pad off non-game pages */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>body[data-page="details"] .pad-bar,</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>body[data-page="players"] .pad-bar,</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>body[data-page="leaderboard"] .pad-bar.hidden { display:none; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>body[data-page="game"] .pad-bar { display:block; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Fixed Throw Pad */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.pad-bar{position:fixed;left:0;right:0;bottom:0;background:rgba(17,19,38,.96);backdrop-filter:blur(6px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>border-top:1px solid #23284a;z-index:100000;padding-bottom:max(8px, env(safe-area-inset-bottom))}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.pad-inner{max-width:1100px;margin:0 auto;padding:8px 12px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.pad-head{display:flex;justify-content:space-between;align-items:center;gap:10px;margin-bottom:6px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.pad-left{display:flex;align-items:center;gap:10px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.pad-hint{color:#a8acc3;font-size:.82rem}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.pad{display:flex;flex-wrap:wrap;gap:6px;max-height:114px;overflow:auto;align-items:flex-start}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.pad .btn{min-width:52px;min-height:38px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.pad-spacer{flex:1 1 auto}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Modal */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.modal-backdrop{position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; z-index:400000}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.modal{background:#0f1329; border:1px solid #2a2e48; border-radius:14px; box-shadow:var(--shadow); padding:12px; width:92%; max-width:640px}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.modal h3{ margin:0 0 8px 0; font-size:1.02rem }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.modal-body{ max-height:60vh; overflow:auto; padding-right:2px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.modal-footer{ margin-top:10px; display:flex; gap:8px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.hs-table{ width:100%; border-collapse:separate; border-spacing:0 }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.hs-table th, .hs-table td{ padding:.5rem .5rem; border-bottom:1px dashed #23284a; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.hs-table th{ text-align:left; color:#cfd3ee; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Add / Select Player Modals */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>#addPlayerModal.hidden, #selectPlayerModal.hidden, #adminHubModal.hidden, #savedPlayersAdminModal.hidden { display:none; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Compact admin tables */</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.compact * { font-size: 12px !important; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.compact .btn { padding: 4px 8px; font-weight: 600; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>.compact table th, .compact table td { padding: .35rem .4rem; }</p>
<p class="p2"><span class="Apple-converted-space">Â Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>/* Cloud status pill (bottom-right) */</p>
<p class="p1">.cloud-status {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>position: fixed;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>right: 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>bottom: 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>background: rgba(10, 12, 30, .92);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>border: 1px solid #2b3050;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>color: var(--muted);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>font-size: 11px;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>padding: 4px 8px;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>border-radius: 999px;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>display: flex;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>align-items: center;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>gap: 6px;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>z-index: 500000;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>pointer-events: none;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">.cloud-status .cloud-dot {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>width: 8px;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>height: 8px;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>border-radius: 50%;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>background: #666;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/* States */</p>
<p class="p1">.cloud-status.checking .cloud-dot { background: var(--warn); }</p>
<p class="p1">.cloud-status.ok <span class="Apple-converted-space">Â  Â  Â  </span>.cloud-dot { background: var(--accent-2); }</p>
<p class="p1">.cloud-status.error<span class="Apple-converted-space">Â  Â  </span>.cloud-dot { background: var(--danger); }</p>
<p class="p2"><span class="Apple-converted-space">Â Â </span></p>
<p class="p1">&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body data-page="details"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div class="wrap"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- PAGE 1: GAME DETAILS --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;section id="details" class="card section"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;Game Details&lt;/h2&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="start-actions column" style="gap:8px; max-width:480px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="questBtn" class="btn primary big" type="button"&gt;New game â–¶&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="resumeBtn" class="btn good big" type="button" disabled title="No saved match"&gt;Resume game â–¶&lt;/button&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="row" style="justify-content:center; gap:8px; flex-wrap:wrap; margin-top:4px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button id="hsMenuBtn" class="btn" type="button"&gt;High Scores (League)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button id="playerStatsBtn" class="btn" type="button"&gt;Player Stats&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button id="hsMenuBtnSP" class="btn" type="button"&gt;High Scores (Practice)&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;!-- Single Admin Code row --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row" id="adminCodeRow" style="margin-top:16px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="grow" style="max-width:360px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;input id="adminCode" placeholder="Admin Code" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="adminEnterBtn" class="btn" type="button"&gt;Enter&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- PAGE 2: PLAYER SELECT --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;section id="players" class="card section hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row" style="position: relative; height: 40px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button class="btn" style="position: absolute; top: 0; left: 0;" id="backToDetailsBtn"&gt;â† Game Details&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;Player Select&lt;/h2&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row" style="max-width:640px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="column" style="flex:1; min-width:220px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;label class="tag" for="psNumGames"&gt;Number of games&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;select id="psNumGames"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;option value="1"&gt;1 game&lt;/option&gt;&lt;option value="2"&gt;2 games&lt;/option&gt;&lt;option value="3"&gt;3 games&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;option value="4"&gt;4 games&lt;/option&gt;&lt;option value="5" selected&gt;5 games&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="column" style="flex:1; min-width:220px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;label class="tag" for="psNumPlayers"&gt;Number of players&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;select id="psNumPlayers"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;option value="1"&gt;1 player (Training)&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;option value="2" selected&gt;2 players&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;option value="3"&gt;3 players&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;option value="4"&gt;4 players&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;option value="5"&gt;5 players&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;option value="6"&gt;6 players&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div id="psPlayerFields" class="column" style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;!-- Rows injected --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row" style="margin-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="startMatchBtn" class="btn primary big" type="button"&gt;Start Match â–¶&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!--PAGE3: GAME --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;section id="game" class="hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="card section"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="row" style="position: relative; height: 40px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button id="startScreenBtn" class="btn" style="position: absolute; top: 0; left: 0;"&gt;Start Screen&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button id="restartGameBtn" class="btn" style="position: absolute; top: 0; left: 110px;"&gt;Restart Game&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="row" id="topControls"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="tag"&gt;Match &lt;b id="matchLabel"&gt;â€“&lt;/b&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="tag" id="roundTag"&gt;Round &lt;b id="roundLabel"&gt;â€“&lt;/b&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="tag"&gt;Player &lt;b id="turnLabel"&gt;â€“&lt;/b&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="tag" id="dartTag"&gt;Dart &lt;b id="dartLabel"&gt;â€“&lt;/b&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;span class="grow"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;!-- Floating names + wins + totals --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="float-head" id="floatHead"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="table-wrap" id="floatWrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;table aria-hidden="true"&gt;&lt;thead id="floatThead"&gt;&lt;/thead&gt;&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;!-- Scoreboard --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="table-wrap" id="scoreWrap" style="margin-top:10px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;table aria-label="Scoreboard"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;thead id="thead"&gt;&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;tbody id="tbody"&gt;&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;!-- Hidden stats tables used to keep column widths aligned --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="stats-box"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="table-wrap" id="statsWrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;table aria-label="Player statistics"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;thead id="statsThead"&gt;&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;tbody id="statsTbody"&gt;&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="stats-box"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="table-wrap" id="mstatsWrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;table aria-label="Match statistics"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;thead id="mstatsThead"&gt;&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>&lt;tbody id="mstatsTbody"&gt;&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div id="endBanner" class="banner hidden"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/section&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;!-- LEADERBOARD --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;section id="leaderboard" class="card section hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row" style="position: relative; height: 40px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="startScreenBtnLB" class="btn" style="position: absolute; top: 0; left: 0;"&gt;Start Screen&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="restartGameBtnLB" class="btn" style="position: absolute; top: 0; left: 110px;"&gt;Restart Game&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2&gt;Leaderboard&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;p class="tag"&gt;&lt;span id="lbMatchInfo"&gt;&lt;/span&gt;&lt;/p&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="table-wrap" style="margin-top:8px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;table id="lbTable"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;thead&gt;&lt;/thead&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;tbody&gt;&lt;/tbody&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/table&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="row" style="margin-top:10px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="nextGameBtn" class="btn primary big" type="button"&gt;Next game â–¶&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span class="grow"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="gameScoresBtn" class="btn" type="button"&gt;Game Scores&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="newMatchBtn" class="btn danger" type="button"&gt;ğŸ—‘ END MATCH&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span id="gamesRemainTag" class="tag"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/section&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;!-- Fixed Throw Pad (Game Stats / Match Stats / High Scores / Race appear here) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div class="pad-bar" id="padBar"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="pad-inner"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="pad-head"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="pad-left"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;strong&gt;Throw Pad&lt;/strong&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div id="padHint" class="pad-hint"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div id="pad" class="pad"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â </span>&lt;!-- Add Player Modal --&gt;</p>
<p class="p1">&lt;div id="addPlayerModal" class="modal-backdrop hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div class="modal"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;h3&gt;Add New Player&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="modal-body"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="stack"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label class="tag" for="newPlayerName"&gt;Player Name&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;input id="newPlayerName" type="text" placeholder="Enter player name" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="stack" style="margin-top: 15px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;label class="tag" for="newPlayerPassword"&gt;Password&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;input id="newPlayerPassword" type="password" placeholder="Enter password" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="modal-footer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button id="cancelAddPlayerBtn" class="btn" type="button"&gt;Cancel&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button id="savePlayerBtn" class="btn primary" type="button"&gt;Save Player&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;!-- Select Player Modal --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div id="selectPlayerModal" class="modal-backdrop hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="modal"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h3&gt;Select Player&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="modal-body"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="stack"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;label class="tag"&gt;Player Name&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;select id="existingPlayerSelect" style="width: 100%;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;option value=""&gt;Select a saved player...&lt;/option&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/select&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="stack" style="margin-top: 15px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;label class="tag" for="playerPassword"&gt;Password&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;input id="playerPassword" type="password" placeholder="Enter password" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="modal-footer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="cancelSelectPlayerBtn" class="btn" type="button"&gt;Cancel&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="confirmSelectPlayerBtn" class="btn primary" type="button"&gt;Confirm&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;!-- Admin Hub Modal --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div id="adminHubModal" class="modal-backdrop hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="modal"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h3&gt;Admin Hub&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="modal-body"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div class="row"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button id="openHsLeagueAdmin" class="btn"&gt;League High Scores Admin&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button id="openHsPracticeAdmin" class="btn"&gt;Practice High Scores Admin&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button id="openSavedPlayersAdmin" class="btn"&gt;Saved Players Admin&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="modal-footer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="closeAdminHubBtn" class="btn" type="button"&gt;Close&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;!-- Saved Players Admin Modal --&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div id="savedPlayersAdminModal" class="modal-backdrop hidden"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div class="modal compact"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h3&gt;Saved Players Admin&lt;/h3&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="modal-body"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div id="savedPlayersAdminBody"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="modal-footer"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;button id="closeSavedPlayersAdminBtn" class="btn" type="button"&gt;Close&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div id="cloudStatus" class="cloud-status checking"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;span class="cloud-dot"&gt;&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;span id="cloudStatusText"&gt;Checking cloudâ€¦&lt;/span&gt;</p>
<p class="p1">&lt;/div&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">/**********************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* CONFIG: Supabase</p>
<p class="p1"><span class="Apple-converted-space">Â </span>**********************/</p>
<p class="p1">const SUPABASE_URL = "https://vvfqumgtasuacpggdmxx.supabase.co";</p>
<p class="p1">const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ2ZnF1bWd0YXN1YWNwZ2dkbXh4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI5NTk0MDMsImV4cCI6MjA3ODUzNTQwM30.8NblWOwEsY1FP1hxvO6isQ908NyxkTgntnZZiXIFPHE";</p>
<p class="p1">const sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON);</p>
<p class="p2"><br></p>
<p class="p1">const TABLE_PLAYERS = "players";</p>
<p class="p1">const TABLE_HS_LEAGUE = "high_scores";</p>
<p class="p1">const TABLE_HS_PRACTICE = "high_scores_sp";</p>
<p class="p2"><br></p>
<p class="p1">/**********************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* SAFETY + TOAST</p>
<p class="p1"><span class="Apple-converted-space">Â </span>**********************/</p>
<p class="p1">(function(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>window.addEventListener('error', function(e){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>var b=document.getElementById('__err_banner')||document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>b.id='__err_banner';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>b.style.cssText='position:fixed;left:0;right:0;top:0;background:#7a2e3f;color:#fff;padding:8px 12px;z-index:999999;font-weight:800';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>b.textContent='JS error: ' + (e.message||'(open console)');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>document.body.appendChild(b);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!window.toast){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>window.toast=function(msg){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>var d=document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>d.textContent=msg;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>d.style.cssText='position:fixed;left:50%;top:16px;transform:translateX(-50%);background:#121735;border:1px solid #2b3050;color:#e7e9f5;padding:8px 12px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.35);z-index:110000';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>document.body.appendChild(d); setTimeout(function(){d.remove();},1700);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1">})();</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* CORE HELPERS</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">const byId = id =&gt; document.getElementById(id);</p>
<p class="p1">const STORAGE_KEY='shateki_quest_scorer_v6';</p>
<p class="p1">const HS_KEY='shateki_quest_highscores_v1'; <span class="Apple-converted-space">Â  Â  Â  </span>// kept for backward-compat local</p>
<p class="p1">const HS_KEY_SP='shateki_quest_highscores_sp_v1'; // kept for backward-compat local</p>
<p class="p1">const safeSave=(k,o)=&gt;{try{localStorage.setItem(k,JSON.stringify(o));}catch(e){}};</p>
<p class="p1">const safeLoad=k=&gt;{try{const r=localStorage.getItem(k);return r?JSON.parse(r):null;}catch(e){return null;}};</p>
<p class="p1">const safeClear=k=&gt;{try{localStorage.removeItem(k);}catch(e){}};</p>
<p class="p2"><br></p>
<p class="p1">const COLOR_PALETTE=['#7bdcff','#8cff9e','#ffcc66','#ff9bd6','#f8d66d','#a6b3ff','#7fffd4','#ffb27b','#ffd166','#06d6a0','#118ab2','#ef476f'];</p>
<p class="p1">function assignUniqueColors(arr){ for(let i=0;i&lt;arr.length;i++){ arr[i].color = COLOR_PALETTE[i % COLOR_PALETTE.length]; } }</p>
<p class="p2"><br></p>
<p class="p1">// Cloud status indicator</p>
<p class="p1">const cloudStatusEl <span class="Apple-converted-space">Â  Â  </span>= byId('cloudStatus');</p>
<p class="p1">const cloudStatusTextEl = byId('cloudStatusText');</p>
<p class="p2"><br></p>
<p class="p1">function setCloudStatus(mode, text) {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (!cloudStatusEl || !cloudStatusTextEl) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>cloudStatusEl.classList.remove('ok', 'error', 'checking');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>cloudStatusEl.classList.add(mode);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>cloudStatusTextEl.textContent = text;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function markCloudOk() {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>setCloudStatus('ok', 'Cloud: connected');</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function markCloudError(err) {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>console.error('[Supabase]', err);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>setCloudStatus('error', 'Cloud: problem â€“ using local');</p>
<p class="p1">}</p>
<p class="p1">function addPadUtilityButtons() {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const spacer = document.createElement('span');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>spacer.className = 'pad-spacer';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>pad.appendChild(spacer);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const gameStatsBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>gameStatsBtn.className = 'btn';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>gameStatsBtn.textContent = 'Game Stats';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>gameStatsBtn.onclick = openGameStatsDialog;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const matchStatsBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>matchStatsBtn.className = 'btn';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>matchStatsBtn.textContent = 'Match Stats';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>matchStatsBtn.onclick = openMatchStatsDialog;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const hsBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>hsBtn.className = 'btn good';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>hsBtn.textContent = 'High Scores';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>hsBtn.onclick = openHighScoresDialog;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const raceBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>raceBtn.className = 'btn warn';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>raceBtn.textContent = 'Race';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>raceBtn.onclick = openGameRaceDialog;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>pad.append(gameStatsBtn, matchStatsBtn, hsBtn, raceBtn);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function show(id){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>['details','players','game','leaderboard'].forEach(x=&gt;byId(x)?.classList.add('hidden'));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId(id)?.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.body.setAttribute('data-page', id);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updatePadSpacer();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const fh=byId('floatHead');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(fh) fh.classList.toggle('hidden', id!=='game');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>buildPad();</p>
<p class="p1">}</p>
<p class="p1">const padBar = byId('padBar');</p>
<p class="p1">function updatePadSpacer(){ try{ const h=padBar?padBar.getBoundingClientRect().height:148; document.documentElement.style.setProperty('--pad-h', h+'px'); }catch(e){} }</p>
<p class="p1">addEventListener('resize',updatePadSpacer,{passive:true}); addEventListener('orientationchange',updatePadSpacer,{passive:true});</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* GAME &amp; STATE</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">const ROUNDS = (()=&gt;{ const a=[]; for(let i=0;i&lt;11;i++) a.push({type:'number',target:10+i}); a.push({type:'doubles'},{type:'triples'},{type:'bull'}); return a; })();</p>
<p class="p1">const MAX_ROUNDS=ROUNDS.length;</p>
<p class="p1">const state={ players:[], score:[], currentRound:0,currentPlayer:0,currentDart:0, history:[], finished:false, suddenDeath:{active:false, participants:[], turnIndex:0, throws:[], round:1}, match:{ totalGames:5, gameNumber:1, wins:[], history:[] }, matchAgg:null };</p>
<p class="p1">const totalScoreForPlayer = i =&gt; (state.score[i]||[]).reduce((s,row)=&gt;s+(row?.roundTotal||0),0);</p>
<p class="p1">const save=()=&gt;safeSave(STORAGE_KEY,state);</p>
<p class="p1">function ensureMatchAgg(){ if(state.matchAgg &amp;&amp; state.matchAgg.hits) return; state.matchAgg={ hits:Array.from({length:state.players.length},()=&gt;({})), totals60:Array.from({length:state.players.length},()=&gt;0), totals100:Array.from({length:state.players.length},()=&gt;0), totals140:Array.from({length:state.players.length},()=&gt;0) }; }</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* SUPABASE HELPERS</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">// simple SHA-256 hex for demo auth (client-side)</p>
<p class="p1">async function sha256Hex(text){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const enc = new TextEncoder().encode(text);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const buf = await crypto.subtle.digest('SHA-256', enc);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return [...new Uint8Array(buf)].map(b=&gt;b.toString(16).padStart(2,'0')).join('');</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// PLAYERS</p>
<p class="p1">async function cloudListPlayers(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const { data, error } = await sb.from(TABLE_PLAYERS).select('name').order('name');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudError(error);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>throw error;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>markCloudOk();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return data || [];</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function cloudCreatePlayer(name, password){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const password_hash = await sha256Hex(password);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const { error } = await sb.from(TABLE_PLAYERS).upsert({ name, password_hash }, { onConflict: 'name' });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudError(error);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>throw error;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>markCloudOk();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function cloudValidatePlayer(name, password){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const hash = await sha256Hex(password);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const { data, error } = await sb.from(TABLE_PLAYERS)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.select('name, password_hash')</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.eq('name', name)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.maybeSingle();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudError(error);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>throw error;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>markCloudOk();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (!data) return false;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return data.password_hash === hash;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function cloudDeletePlayer(name){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const { error } = await sb.from(TABLE_PLAYERS).delete().eq('name', name);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudError(error);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>throw error;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>markCloudOk();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function cloudUpdatePlayerPassword(name, newPassword){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const password_hash = await sha256Hex(newPassword);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const { error } = await sb.from(TABLE_PLAYERS).update({ password_hash }).eq('name', name);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudError(error);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>throw error;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>markCloudOk();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Simple initial Supabase connectivity check</p>
<p class="p1">async function initialCloudCheck() {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// keep UI consistent</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>setCloudStatus('checking', 'Checking cloudâ€¦');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// cheap HEAD-style query against players table</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const { error } = await sb</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>.from(TABLE_PLAYERS)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>.select('name', { head: true, count: 'exact' });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (error) throw error;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudOk();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} catch (err) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudError(err);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// HIGH SCORES</p>
<p class="p1">async function cloudInsertHighScore(name, score, single=false){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const table <span class="Apple-converted-space">Â  </span>= single ? TABLE_HS_PRACTICE : TABLE_HS_LEAGUE;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const payload = { name, score, ts: new Date().toISOString() };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const { error } = await sb.from(table).insert(payload);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudError(error);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>throw error;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>markCloudOk();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function cloudListHighScores(single=false, limit=20){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const table = single ? TABLE_HS_PRACTICE : TABLE_HS_LEAGUE;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const { data, error } = await sb.from(table)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.select('name, score, ts')</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.order('score', { ascending:false })</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.order('ts', { ascending:true })</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.limit(limit);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudError(error);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>throw error;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>markCloudOk();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return data || [];</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function cloudDeleteHighScore(row, single=false){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const table = single ? TABLE_HS_PRACTICE : TABLE_HS_LEAGUE;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const { error } = await sb.from(table).delete()</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.eq('name', row.name)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.eq('score', row.score)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.eq('ts', row.ts);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (error) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>markCloudError(error);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>throw error;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>markCloudOk();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* DETAILS PAGE (page 1)</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">const resumeBtn=byId('resumeBtn');</p>
<p class="p1">function getSavedState(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const raw=localStorage.getItem(STORAGE_KEY);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(!raw) return null;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const saved=JSON.parse(raw);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(!saved||!Array.isArray(saved.players)||!saved.players.length) return null;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>return saved;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}catch(e){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>return null;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function setupStartMenuButtons(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const saved=getSavedState();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const hasSaved=!!saved;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>resumeBtn.disabled=!hasSaved;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>resumeBtn.title=hasSaved?'Resume last match':'No saved match';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(hasSaved){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>resumeBtn.onclick=()=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>Object.assign(state,saved);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>show('game');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>assignUniqueColors(state.players);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>buildEverything();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>updateUI();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>toast('Resumed last match');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>};<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} else {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>resumeBtn.onclick=null;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('hsMenuBtn').onclick <span class="Apple-converted-space">Â  </span>= openHighScoresDialog;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('hsMenuBtnSP').onclick = openHighScoresDialogSP;<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// TEMP: wire Player Stats to a placeholder dialog</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('playerStatsBtn').onclick = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>toast('Player Stats coming soon');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>};</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">byId('questBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// go to Player Select</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>show('players');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// sync dropdown defaults from details (if you want, you can keep psNumGames default 5)</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">byId('startScreenBtn')?.addEventListener('click', ()=&gt;show('details'));</p>
<p class="p1">byId('startScreenBtnLB')?.addEventListener('click', ()=&gt;show('details'));</p>
<p class="p1">byId('backToDetailsBtn')?.addEventListener('click', ()=&gt;show('details'));</p>
<p class="p2"><br></p>
<p class="p1">byId('adminEnterBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const code=(byId('adminCode')?.value||'').trim();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(code.toLowerCase()==='hownowbrowncow'){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>byId('adminCode').value='';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>openAdminHub();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}else{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>toast('Invalid code');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* PLAYER SELECT (page 2)</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">const psNumGamesSel = byId('psNumGames');</p>
<p class="p1">const psNumPlayersSel = byId('psNumPlayers');</p>
<p class="p1">const psPlayerFields = byId('psPlayerFields');</p>
<p class="p2"><br></p>
<p class="p1">function drawPsRows(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const count = parseInt(psNumPlayersSel.value,10) || 2;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>psPlayerFields.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=1;i&lt;=count;i++){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const row = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>row.className='row pf';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>row.dataset.index=String(i);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>row.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="grow"&gt;&lt;input placeholder="Guest Player Name" data-role="display"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn select-player-btn" type="button"&gt;Select Player&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn primary save-player-btn" type="button"&gt;Save Player&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>psPlayerFields.appendChild(row);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// wire buttons per row</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>[...psPlayerFields.querySelectorAll('.pf')].forEach(row=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const idx = parseInt(row.dataset.index,10);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>row.querySelector('.select-player-btn').onclick = ()=&gt; showSelectPlayerDialog(idx);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>row.querySelector('.save-player-btn').onclick = ()=&gt; showAddPlayerDialog(idx);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">psNumPlayersSel.addEventListener('change', drawPsRows);</p>
<p class="p1">psNumGamesSel.addEventListener('change', ()=&gt;{/* nothing else; read on start */});</p>
<p class="p1">// ---- Saved players helpers (shared by Add + Select modals) ----</p>
<p class="p1">function getSavedPlayers(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try { return JSON.parse(localStorage.getItem('shateki_players') || '[]'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>catch(e){ return []; }</p>
<p class="p1">}</p>
<p class="p1">function setSavedPlayers(arr){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try { localStorage.setItem('shateki_players', JSON.stringify(arr)); }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>catch(e){}</p>
<p class="p1">}</p>
<p class="p1">function populateSavedPlayersSelects(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const arr = getSavedPlayers();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const sel1 = document.getElementById('existingPlayers'); <span class="Apple-converted-space">Â  Â  Â  </span>// Add Player modal</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const sel2 = document.getElementById('existingPlayerSelect');<span class="Apple-converted-space">Â  </span>// Select Player modal</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>[sel1, sel2].forEach(sel=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(!sel) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>sel.innerHTML = '&lt;option value=\"\"&gt;Select a saved player...&lt;/option&gt;' +</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>arr.map(p=&gt;`&lt;option value="${p.name}"&gt;${p.name}&lt;/option&gt;`).join('');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p1">}</p>
<p class="p1">async function showAddPlayerDialog(index){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal = byId('addPlayerModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (!modal) { toast('Add Player modal missing'); return; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let chosenName = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function finish(msg){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const idx = parseInt(modal.dataset.playerIndex || '0', 10) || 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const row =</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>document.querySelector(`#psPlayerFields .pf[data-index="${idx}"]`) ||</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>document.querySelector(`.pf[data-index="${idx}"]`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const input = row?.querySelector('input[data-role="display"]');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (input) input.value = chosenName || '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// close + reset</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>modal.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>byId('newPlayerName').value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>byId('newPlayerPassword').value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>toast(msg);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Reset fields</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('newPlayerName').value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('newPlayerPassword').value = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Remember which row invoked the dialog</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.dataset.playerIndex = index ? String(index) : '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Show</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.classList.remove('hidden');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Wire buttons</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const saveBtn <span class="Apple-converted-space">Â  </span>= byId('savePlayerBtn');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const cancelBtn = byId('cancelAddPlayerBtn');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>saveBtn.onclick = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const newName = byId('newPlayerName').value.trim();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const newPass = byId('newPlayerPassword').value;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!newName || !newPass) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>toast('Enter name &amp; password');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Local duplicate check (same device)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const players = getSavedPlayers();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (players.some(p =&gt; p.name.toLowerCase() === newName.toLowerCase())) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>toast('Name already exists');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Cloud create (global, multi-device)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>await cloudCreatePlayer(newName, newPass);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} catch (err) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>console.error(err);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>toast('Cloud save failed');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Also keep a local cache for offline / legacy behaviour</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>players.push({ name: newName, password: newPass });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>setSavedPlayers(players);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>chosenName = newName;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>finish('Player saved');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>cancelBtn.onclick = () =&gt; modal.classList.add('hidden');</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function showSelectPlayerDialog(index){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const select = byId('existingPlayerSelect');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>select.innerHTML = '&lt;option value=""&gt;Select a saved player...&lt;/option&gt;';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Primary: cloud players</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const list = await cloudListPlayers();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>list.forEach(p=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const opt = document.createElement('option');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>opt.value = p.name;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>opt.textContent = p.name;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>select.appendChild(opt);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Fallback: legacy local players if cloud is empty</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!list.length) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const local = getSavedPlayers();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>local.forEach(p=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const opt = document.createElement('option');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>opt.value = p.name;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>opt.textContent = p.name;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>select.appendChild(opt);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const modal = byId('selectPlayerModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>modal.dataset.playerIndex = String(index);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>modal.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}catch(err){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>console.error(err);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>toast('Load players failed');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">byId('cancelSelectPlayerBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('existingPlayerSelect').value='';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('playerPassword').value='';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('selectPlayerModal').classList.add('hidden');</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">byId('confirmSelectPlayerBtn').onclick = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal = byId('selectPlayerModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const idx <span class="Apple-converted-space">Â  </span>= parseInt(modal.dataset.playerIndex || '0', 10) || 1;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const name = byId('existingPlayerSelect').value;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const pass = byId('playerPassword').value;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (!name || !pass) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>toast('Enter player &amp; password');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let ok = false;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Try cloud first</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ok = await cloudValidatePlayer(name, pass);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} catch (err) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>console.error(err);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Fallback to local cache if cloud fails or returns false</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (!ok) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const players = getSavedPlayers();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const found <span class="Apple-converted-space">Â  </span>= players.find(p =&gt; p.name === name);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!found || found.password !== pass) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>toast('Incorrect name or password');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Write back into the correct Player Select row</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const row =</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>document.querySelector(`#psPlayerFields .pf[data-index="${idx}"]`) ||</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>document.querySelector(`.pf[data-index="${idx}"]`);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const input = row?.querySelector('input[data-role="display"]');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (input) input.value = name;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('playerPassword').value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('existingPlayerSelect').value = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>toast('Player selected');</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">byId('startMatchBtn').addEventListener('click', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Build state from Player Select</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const games = parseInt(psNumGamesSel.value,10) || 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const rows = [...psPlayerFields.querySelectorAll('.pf')];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const ppl = rows.map((row,i)=&gt;({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>name:(row.querySelector('input[data-role="display"]').value||'').trim() || `Player ${i+1}`</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!ppl.length){ toast('Add at least 1 player'); return; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.players = ppl.map(p=&gt;({ name:p.name, color:null }));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>assignUniqueColors(state.players);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.match = { totalGames:games, gameNumber:1, wins:Array.from({length:state.players.length},()=&gt;0), history:[] };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.matchAgg=null; ensureMatchAgg();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>startNewGame(false); // will show order dialog first</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>setupStartMenuButtons();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>save();</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* BUILDERS</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">const thead=byId('thead'), tbody=byId('tbody');</p>
<p class="p1">const statsThead=byId('statsThead'), statsTbody=byId('statsTbody');</p>
<p class="p1">const mstatsThead=byId('mstatsThead'), mstatsTbody=byId('mstatsTbody');</p>
<p class="p1">const floatThead=byId('floatThead');</p>
<p class="p2"><br></p>
<p class="p1">function buildScoreHeader(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Main scoreboard header is now minimal â€“ only used for layout/scroll sync.</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead.innerHTML = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const tr = document.createElement('tr');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Left column label</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thRound = document.createElement('th');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thRound.textContent = 'Round';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>tr.appendChild(thRound);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// One blank header cell per player (no Game Wins / names / totals here)</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for (let i = 0; i &lt; state.players.length; i++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th = document.createElement('th');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.className = 'player';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.textContent = ''; // keep it visually empty; floating header shows the info</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tr.appendChild(th);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead.appendChild(tr);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function buildScoreBody(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>tbody.innerHTML='';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let r=0;r&lt;MAX_ROUNDS;r++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const tr=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th=document.createElement('th');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.textContent=(ROUNDS[r].type==='number')?(ROUNDS[r].target+'s'):(ROUNDS[r].type==='doubles'?'Doubles':(ROUNDS[r].type==='triples'?'Triples':'Bull'));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tr.appendChild(th);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(let p=0;p&lt;state.players.length;p++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td=document.createElement('td');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.className='center num player';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.id=`cell-${p}-${r}`;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.textContent='â€“';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>tr.appendChild(td);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tbody.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function buildFloatingHeader(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>floatThead.innerHTML='';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Wins row</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const trWins=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thWins=document.createElement('th'); thWins.textContent='Game Wins'; trWins.appendChild(thWins);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;state.players.length;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th=document.createElement('th'); th.className='player'; th.style.color=state.players[i].color;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const wins=document.createElement('div'); wins.className='th-beers'; wins.id='fbeers-'+i; wins.textContent='';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.appendChild(wins); trWins.appendChild(th);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} <span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Names row</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const trNames=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thNames=document.createElement('th'); thNames.textContent='Player'; trNames.appendChild(thNames);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;state.players.length;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th=document.createElement('th'); th.className='player'; th.style.color=state.players[i].color;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const wrap=document.createElement('div'); wrap.className='th-wrap';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const name=document.createElement('div'); name.className='th-name'; name.textContent=state.players[i].name;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const arrow=document.createElement('div'); arrow.className='th-throw-arrow'; arrow.id='fdartarrow-'+i; arrow.textContent='';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>wrap.append(name,arrow); th.appendChild(wrap); trNames.appendChild(th);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} <span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Totals row</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const trTotals=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thTotals=document.createElement('th'); thTotals.textContent='Total'; thTotals.className='th-diff-label'; trTotals.appendChild(thTotals);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;state.players.length;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th=document.createElement('th'); th.className='player';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const total=document.createElement('div'); total.className='th-total th-name num'; total.id='ftotal-'+i; total.textContent='0';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.appendChild(total); trTotals.appendChild(th);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} <span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Diff row</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const trDiff=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thDiff=document.createElement('th'); thDiff.textContent='(+/âˆ’)'; thDiff.className='th-diff-label'; trDiff.appendChild(thDiff);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;state.players.length;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th=document.createElement('th'); th.className='player';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const diff=document.createElement('div'); diff.className='th-diff'; diff.id='fdiff-'+i; diff.textContent='0';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.appendChild(diff); trDiff.appendChild(th);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} <span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>floatThead.append(trWins,trNames,trTotals,trDiff);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* STATS (modal compute)</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">const METRICS = [</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'miss', <span class="Apple-converted-space">Â  Â  Â  Â  </span>label: '% Miss', <span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>fmt: v =&gt; v + '%' },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'single', <span class="Apple-converted-space">Â  Â  Â  </span>label: '% Singles',<span class="Apple-converted-space">Â  Â  Â  Â  </span>fmt: v =&gt; v + '%' },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'double', <span class="Apple-converted-space">Â  Â  Â  </span>label: '% Doubles',<span class="Apple-converted-space">Â  Â  Â  Â  </span>fmt: v =&gt; v + '%' },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'treble', <span class="Apple-converted-space">Â  Â  Â  </span>label: '% Trebles',<span class="Apple-converted-space">Â  Â  Â  Â  </span>fmt: v =&gt; v + '%' },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'bulls',<span class="Apple-converted-space">Â  Â  Â  Â  </span>label: '% Bulls (I+O)',<span class="Apple-converted-space">Â  Â  </span>fmt: v =&gt; v + '%' },</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// NEW: per-round power scoring</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'sixtyPlus',<span class="Apple-converted-space">Â  Â  </span>label: '60+ Rounds', <span class="Apple-converted-space">Â  Â  Â  </span>fmt: v =&gt; String(v) },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'hundredPlus',<span class="Apple-converted-space">Â  </span>label: '100+ Rounds',<span class="Apple-converted-space">Â  Â  Â  </span>fmt: v =&gt; String(v) },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'oneFortyPlus', label: '140+ Rounds',<span class="Apple-converted-space">Â  Â  Â  </span>fmt: v =&gt; String(v) },</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'avg9', <span class="Apple-converted-space">Â  Â  Â  Â  </span>label: 'Avg (last 9)', <span class="Apple-converted-space">Â  Â  </span>fmt: v =&gt; v.toFixed(1) },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'avgRound', <span class="Apple-converted-space">Â  Â  </span>label: 'Avg (round)',<span class="Apple-converted-space">Â  Â  Â  </span>fmt: v =&gt; v.toFixed(1) },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'avgGame',<span class="Apple-converted-space">Â  Â  Â  </span>label: 'Avg (throw)',<span class="Apple-converted-space">Â  Â  Â  </span>fmt: v =&gt; v.toFixed(1) },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'singleStreak', label: 'Single Streak',<span class="Apple-converted-space">Â  Â  </span>fmt: v =&gt; String(v) },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'roundStreak',<span class="Apple-converted-space">Â  </span>label: 'Round Streak', <span class="Apple-converted-space">Â  Â  </span>fmt: v =&gt; String(v) },</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>{ key: 'bestNumber', <span class="Apple-converted-space">Â  </span>label: 'Best Number',<span class="Apple-converted-space">Â  Â  Â  </span>fmt: v =&gt; v || 'â€”' }</p>
<p class="p1">];</p>
<p class="p1">function computeStatsFromBoards(boards, pIdx) {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// boards: array of [player][round] objects in the same shape as state.score</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const dartsFlat = [];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const perNumberTotals = {};</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const perRoundHit = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let completedRounds = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let completedPoints = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let rounds60 = 0, rounds100 = 0, rounds140 = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>boards.forEach(board =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!board || !board[pIdx]) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for (let r = 0; r &lt; MAX_ROUNDS; r++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const roundDef = ROUNDS[r];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const entry = board[pIdx][r];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!entry) continue;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const d = entry.darts || [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const roundIndex = perRoundHit.length;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>perRoundHit.push(false);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const roundTotal = entry.roundTotal || 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>d.forEach(dart =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (!dart) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const p = dart.points || 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>dartsFlat.push({ dart, roundIndex, roundDef });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (p &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>perRoundHit[roundIndex] = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// fully completed round = 3 darts thrown</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (d[0] &amp;&amp; d[1] &amp;&amp; d[2]) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>completedRounds++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>completedPoints += roundTotal;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (roundTotal &gt;= 60) rounds60++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (roundTotal &gt;= 100) rounds100++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (roundTotal &gt;= 140) rounds140++;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Best number tracking</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>d.forEach(dart =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (!dart || !(dart.points &gt; 0)) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>let key = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (roundDef.type === 'number') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>key = String(roundDef.target);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>} else if (roundDef.type === 'doubles' || roundDef.type === 'triples') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if (dart.sector) key = String(dart.sector);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>} else if (roundDef.type === 'bull') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>key = 'Bull';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (key) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>perNumberTotals[key] = (perNumberTotals[key] || 0) + (dart.points || 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const n = dartsFlat.length;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let miss = 0, singles = 0, doubles = 0, trebles = 0, bulls = 0, pts = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let currentHitStreak = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let bestHitStreak = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for (const { dart } of dartsFlat) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const p = dart.points || 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>pts += p;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const isHit = p &gt; 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (isHit) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>currentHitStreak++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (currentHitStreak &gt; bestHitStreak) bestHitStreak = currentHitStreak;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>currentHitStreak = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (dart.kind === 'Miss') miss++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else if (dart.kind === 'Bull') bulls++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else if (dart.kind === 'S' || dart.kind === 'Single') singles++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else if (dart.kind === 'D' || dart.kind === 'Double') doubles++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else if (dart.kind === 'T' || dart.kind === 'Triple') trebles++;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const pct = v =&gt; n ? Math.round((v / n) * 100) : 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const last9 = dartsFlat.slice(-9);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const sum9<span class="Apple-converted-space">Â  </span>= last9.reduce((a, x) =&gt; a + (x.dart.points || 0), 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const avg9<span class="Apple-converted-space">Â  </span>= last9.length ? (sum9 / last9.length) : 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const avgGame<span class="Apple-converted-space">Â  </span>= n ? (pts / n) : 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const avgRound = completedRounds ? (completedPoints / completedRounds) : 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Round streak across all rounds in all boards</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let currentRoundStreak = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let bestRoundStreak = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for (const hit of perRoundHit) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (hit) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>currentRoundStreak++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (currentRoundStreak &gt; bestRoundStreak) bestRoundStreak = currentRoundStreak;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>currentRoundStreak = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Best number</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let bestNumberKey = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let bestNumberScore = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>Object.keys(perNumberTotals).forEach(key =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const total = perNumberTotals[key];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (total &gt; bestNumberScore) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>bestNumberScore = total;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>bestNumberKey = key;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const bestNumberLabel = bestNumberKey</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>? (bestNumberKey === 'Bull'</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>? `Bull (${bestNumberScore})`</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>: `${bestNumberKey} (${bestNumberScore})`)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>: 'â€”';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>miss: pct(miss),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>single: pct(singles),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>double: pct(doubles),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>treble: pct(trebles),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>bulls: pct(bulls),</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>sixtyPlus:<span class="Apple-converted-space">Â  Â  </span>rounds60,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>hundredPlus:<span class="Apple-converted-space">Â  </span>rounds100,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>oneFortyPlus: rounds140,</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>avg9,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>avgRound,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>avgGame,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>singleStreak: bestHitStreak,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>roundStreak:<span class="Apple-converted-space">Â  </span>bestRoundStreak,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>bestNumber: <span class="Apple-converted-space">Â  </span>bestNumberLabel,</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>totalThrows:<span class="Apple-converted-space">Â  </span>n,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>totalHits:<span class="Apple-converted-space">Â  Â  </span>n - miss,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>totalMisses:<span class="Apple-converted-space">Â  </span>miss,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>bestNumberKey,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>bestNumberScore</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>};</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Per-game stats (current board only)</p>
<p class="p1">function computeStatsForPlayerGame(pIdx) {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return computeStatsFromBoards([state.score], pIdx);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Per-match stats (all finished games + current game)</p>
<p class="p1">function computeStatsForPlayerMatch(pIdx) {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const boards = [];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (state.match &amp;&amp; Array.isArray(state.match.history)) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.match.history.forEach(g =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (g &amp;&amp; Array.isArray(g.board)) boards.push(g.board);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (state.score &amp;&amp; state.score[pIdx]) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>boards.push(state.score);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (!boards.length) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>return computeStatsFromBoards([], pIdx);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return computeStatsFromBoards(boards, pIdx);</p>
<p class="p1">}</p>
<p class="p1">function buildStatsHeader(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>statsThead.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const tr = document.createElement('tr');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thLabel = document.createElement('th');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thLabel.textContent = 'Game Stats';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>tr.appendChild(thLabel);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// one column per player (we keep header blank â€“ names are in the popup)</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for (let i = 0; i &lt; state.players.length; i++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th = document.createElement('th');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.className = 'player';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tr.appendChild(th);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>statsThead.appendChild(tr);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function buildStatsBody(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>statsTbody.innerHTML = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>METRICS.forEach(m =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const tr = document.createElement('tr');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th = document.createElement('th');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.className = 'stats-th';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.textContent = m.label;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tr.appendChild(th);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for (let p = 0; p &lt; state.players.length; p++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td = document.createElement('td');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.className = 'center num player';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.id = `stat-${m.key}-${p}`;<span class="Apple-converted-space">Â  Â  </span>// used by updateStatsRows()</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.textContent = 'â€”';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>tr.appendChild(td);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>statsTbody.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function buildMatchStatsHeader(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>mstatsThead.innerHTML = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const tr = document.createElement('tr');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thLabel = document.createElement('th');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thLabel.textContent = 'Match Stats';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>tr.appendChild(thLabel);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for (let i = 0; i &lt; state.players.length; i++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th = document.createElement('th');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.className = 'player';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tr.appendChild(th);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>mstatsThead.appendChild(tr);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function buildMatchStatsBody(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>mstatsTbody.innerHTML = '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>METRICS.forEach(m =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const tr = document.createElement('tr');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const th = document.createElement('th');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.className = 'stats-th';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>th.textContent = m.label;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tr.appendChild(th);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for (let p = 0; p &lt; state.players.length; p++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td = document.createElement('td');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.className = 'center num player';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.id = `mstat-${m.key}-${p}`; <span class="Apple-converted-space">Â  </span>// used by updateMatchStats()</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.textContent = 'â€”';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>tr.appendChild(td);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>mstatsTbody.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Fill the hidden match-stats table so widths stay in sync and data is there if needed</p>
<p class="p1">function updateMatchStats(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for (let i = 0; i &lt; state.players.length; i++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const v = computeStatsForPlayerMatch(i);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for (const m of METRICS) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td = byId(`mstat-${m.key}-${i}`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (td) td.textContent = m.fmt(v[m.key]);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1">}</p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* UI UPDATE</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">function computeRoundMaxes(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const arr=new Array(MAX_ROUNDS);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let r=0;r&lt;MAX_ROUNDS;r++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let m=0; for(let p=0;p&lt;state.players.length;p++){ m=Math.max(m, state.score[p][r].roundTotal||0); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>arr[r]=m;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} return arr;<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function lastPlayedRoundForPlayer(pIdx){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let r=MAX_ROUNDS-1;r&gt;=0;r--){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const d=state.score[pIdx][r].darts||[];<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(d[0]||d[1]||d[2]) return r;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return -1;<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function updateWinsHeaderDots(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const total=state.match.totalGames||1;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;state.players.length;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const el=byId('fbeers-'+i); if(!el) continue;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const won=state.match.wins[i]||0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const dots='ğŸ¥‡'.repeat(Math.min(won,total)) + 'â—¯'.repeat(Math.max(0,total-won));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>el.textContent=dots;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function updateHeaderStrip(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;state.players.length;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const isTurn = (!state.finished &amp;&amp; i===state.currentPlayer &amp;&amp; !state.suddenDeath.active);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const arrEl=byId('fdartarrow-'+i); if(arrEl) arrEl.textContent = isTurn ? 'ğŸ¯'.repeat(3 - state.currentDart) : '';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const totals=state.players.map((_,i)=&gt;totalScoreForPlayer(i));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const leader = Math.max(0,...totals);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;state.players.length;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>byId('ftotal-'+i).textContent=String(totals[i]||0);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>byId('fdiff-'+i).textContent=String((totals[i]-leader)||0);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateWinsHeaderDots();<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function updateScoreCells(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.querySelectorAll('.current-cell').forEach(n=&gt;n.classList.remove('current-cell'));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.querySelectorAll('.current-col').forEach(n=&gt;n.classList.remove('current-col'));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const roundMax=computeRoundMaxes();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let p=0;p&lt;state.players.length;p++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let running=0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const lastPlayed=lastPlayedRoundForPlayer(p);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(let r=0;r&lt;MAX_ROUNDS;r++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td=byId(`cell-${p}-${r}`);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const entry=state.score[p][r];<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const roundPts=entry.roundTotal||0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const hasDart=entry.darts[0]||entry.darts[1]||entry.darts[2];<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>running+=roundPts;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(r&lt;=lastPlayed){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const subText=hasDart?(roundPts===0?'â€“':String(roundPts)):'â€“';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const isTop=(roundPts===roundMax[r] &amp;&amp; roundMax[r]&gt;0);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>td.innerHTML=`&lt;span class="cell-wrap"&gt;&lt;span class="cell-main"&gt;${running}&lt;/span&gt;&lt;span class="cell-sub${isTop?' sub-win':''}"&gt;(${subText})&lt;/span&gt;&lt;/span&gt;`;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>} else td.textContent='â€“';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!state.finished &amp;&amp; !state.suddenDeath.active){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const cur=byId(`cell-${state.currentPlayer}-${state.currentRound}`); if(cur) cur.classList.add('current-cell');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const headers=thead.querySelectorAll('tr:last-child th'); if(headers[state.currentPlayer+1]) headers[state.currentPlayer+1].classList.add('current-col');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(let rr=0;rr&lt;MAX_ROUNDS;rr++){ const c=byId(`cell-${state.currentPlayer}-${rr}`); if(c) c.classList.add('current-col'); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function updateStatsRows(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;state.players.length;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const v=computeStatsForPlayerGame(i);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(const m of METRICS){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td=byId(`stat-${m.key}-${i}`); if(td) td.textContent=m.fmt(v[m.key]);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function updateUI(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateHeaderStrip();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateScoreCells();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateStatsRows();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateMatchStats();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>buildPad();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>save();<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* PAD + INPUT</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">const pad=byId('pad'), padHint=byId('padHint');</p>
<p class="p1">function buildPad(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (!pad) return;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>pad.innerHTML = '';<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const page = document.body.getAttribute('data-page');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Leaderboard: show tools only</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (page === 'leaderboard') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>padHint.textContent = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>addPadUtilityButtons();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Other non-game pages: no pad</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (page !== 'game') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>padHint.textContent = '';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>return;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Game page</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>padHint.textContent = state.finished ? 'Game finished.' : '';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (!state.finished) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const r = ROUNDS[state.currentRound];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (r?.type === 'number') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>['S','D','T'].forEach(k =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const b = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>b.className = 'btn primary';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>b.textContent = k;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>b.onclick = () =&gt; recordThrow({ kind: k });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>pad.appendChild(b);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const miss = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>miss.className = 'btn danger';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>miss.textContent = 'Miss';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>miss.onclick = () =&gt; recordThrow({ kind: 'Miss' });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pad.appendChild(miss);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const undoBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>undoBtn.className = 'btn warn';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>undoBtn.textContent = 'Undo';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>undoBtn.onclick = undo;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pad.appendChild(undoBtn);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const missGoBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>missGoBtn.className = 'btn';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>missGoBtn.textContent = 'Miss Go';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>missGoBtn.onclick = missGo;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pad.appendChild(missGoBtn);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else if (r?.type === 'doubles' || r?.type === 'triples') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const pref = r.type === 'doubles' ? 'D' : 'T';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let n = 1; n &lt;= 20; n++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const b = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>b.className = 'btn';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>b.textContent = pref + n;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>b.onclick = () =&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>recordThrow({ kind: pref === 'D' ? 'Double' : 'Triple', sector: n });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>pad.appendChild(b);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const miss = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>miss.className = 'btn danger';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>miss.textContent = 'Miss';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>miss.onclick = () =&gt; recordThrow({ kind: 'Miss' });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pad.appendChild(miss);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const undoBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>undoBtn.className = 'btn warn';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>undoBtn.textContent = 'Undo';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>undoBtn.onclick = undo;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pad.appendChild(undoBtn);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const missGoBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>missGoBtn.className = 'btn';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>missGoBtn.textContent = 'Miss Go';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>missGoBtn.onclick = missGo;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pad.appendChild(missGoBtn);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else if (r?.type === 'bull') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>[['Outer (25)', 'Outer'], ['Inner (50)', 'Inner']].forEach(([lbl, val]) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const b = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>b.className = 'btn primary';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>b.textContent = lbl;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>b.onclick = () =&gt; recordThrow({ kind: 'Bull', bull: val });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>pad.appendChild(b);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const miss = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>miss.className = 'btn danger';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>miss.textContent = 'Miss';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>miss.onclick = () =&gt; recordThrow({ kind: 'Miss' });</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pad.appendChild(miss);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const undoBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>undoBtn.className = 'btn warn';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>undoBtn.textContent = 'Undo';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>undoBtn.onclick = undo;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pad.appendChild(undoBtn);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const missGoBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>missGoBtn.className = 'btn';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>missGoBtn.textContent = 'Miss Go';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>missGoBtn.onclick = missGo;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pad.appendChild(missGoBtn);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Finished game: go to leaderboard</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const finishBtn = document.createElement('button');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>finishBtn.className = 'btn good';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>finishBtn.style.minWidth = '220px';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>finishBtn.textContent = 'Finish Game â†’ Leaderboard';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>finishBtn.onclick = async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Prevent the finish modal from re-opening via the interval</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.finished = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>await awardAndShowLeaderboard();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>pad.appendChild(finishBtn);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Game page always gets the utility buttons as well</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>addPadUtilityButtons();</p>
<p class="p1">}</p>
<p class="p1">function missGo(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(state.finished) return;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(state.currentDart&lt;2) state.currentDart=2;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const e=state.score[state.currentPlayer][state.currentRound];<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>e.darts[0]=e.darts[0]||{kind:'Miss',points:0};<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>e.darts[1]=e.darts[1]||{kind:'Miss',points:0};<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>e.darts[2]=e.darts[2]||{kind:'Miss',points:0};<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>e.roundTotal=0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.history.push({player:state.currentPlayer, round:state.currentRound, dartIndex:2, throw:{kind:'Miss',points:0}});<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.currentDart=0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(state.currentPlayer &lt; state.players.length-1) state.currentPlayer++;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>else{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.currentPlayer=0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(state.currentRound &lt; MAX_ROUNDS-1) state.currentRound++;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.finished=true;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>updateUI();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>openFinishModal();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateUI();<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function undo(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (state.history.length === 0) return;<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const last = state.history.pop();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const e<span class="Apple-converted-space">Â  Â  </span>= state.score[last.player][last.round];<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const prev = e.darts[last.dartIndex];<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Adjust favourite-number hits</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (prev &amp;&amp; prev.kind!=='Miss'){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const r = ROUNDS[last.round];<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let key = null;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (r.type==='number') key = String(r.target);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else if (r.type==='doubles'||r.type==='triples') key = String(prev.sector);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else if (r.type==='bull') key = 'Bull';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (key){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const map = state.matchAgg?.hits?.[last.player];<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (map &amp;&amp; map[key]) map[key]--;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Remove dart and recompute round total</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>e.darts[last.dartIndex] = null;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>e.roundTotal =</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>(e.darts[0]?.points||0) +</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>(e.darts[1]?.points||0) +</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>(e.darts[2]?.points||0);<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Recompute 60+/100+/140+ counters for this player</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>recomputeMatchAggTotalsForPlayer(last.player);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.currentPlayer = last.player;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.currentRound<span class="Apple-converted-space">Â  </span>= last.round;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.currentDart <span class="Apple-converted-space">Â  </span>= last.dartIndex;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.finished<span class="Apple-converted-space">Â  Â  Â  </span>= false;<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateUI();<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* DIALOGS (Stats / Race / High Scores)</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">function openGameStatsDialog(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const overlay=document.createElement('div'); overlay.className='modal-backdrop';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal=document.createElement('div'); modal.className='modal';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const title=document.createElement('h3'); title.textContent='Game Stats';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body=document.createElement('div'); body.className='modal-body';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const table=document.createElement('table'); table.className='hs-table';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thead=document.createElement('thead'); const trh=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>trh.appendChild(Object.assign(document.createElement('th'),{textContent:'Metric'}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.players.forEach(p=&gt; trh.appendChild(Object.assign(document.createElement('th'),{textContent:p.name})));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead.appendChild(trh); table.appendChild(thead);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const tb=document.createElement('tbody');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const vByP=state.players.map((_,i)=&gt;computeStatsForPlayerGame(i));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>METRICS.forEach(m=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const tr=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tr.appendChild(Object.assign(document.createElement('th'),{textContent:m.label,className:'stats-th'}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.players.forEach((_,i)=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td=document.createElement('td'); td.className='center num'; td.textContent=m.fmt(vByP[i][m.key]); tr.appendChild(td);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tb.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>table.appendChild(tb); body.appendChild(table);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const footer=document.createElement('div'); footer.className='modal-footer';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const backBtn=document.createElement('button'); backBtn.className='btn'; backBtn.textContent='Back'; backBtn.onclick=()=&gt;overlay.remove(); footer.appendChild(backBtn);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.append(title,body,footer); overlay.appendChild(modal); document.body.appendChild(overlay);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.tabIndex=0; modal.focus();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('click',e=&gt;{ if(e.target===overlay) overlay.remove();});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('keydown',e=&gt;{ if(e.key==='Escape') overlay.remove();});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function openMatchStatsDialog(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const overlay=document.createElement('div'); overlay.className='modal-backdrop';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal=document.createElement('div'); modal.className='modal';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const title=document.createElement('h3'); title.textContent='Match Stats';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body=document.createElement('div'); body.className='modal-body';<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const table=document.createElement('table'); table.className='hs-table';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thead=document.createElement('thead'); const trh=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>trh.appendChild(Object.assign(document.createElement('th'),{textContent:'Metric'}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.players.forEach(p=&gt; trh.appendChild(Object.assign(document.createElement('th'),{textContent:p.name})));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead.appendChild(trh); table.appendChild(thead);<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const tb=document.createElement('tbody');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const vByP = state.players.map((_,i)=&gt;computeStatsForPlayerMatch(i));<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>METRICS.forEach(m =&gt; {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const tr=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tr.appendChild(Object.assign(document.createElement('th'),{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>textContent:m.label,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>className:'stats-th'</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}));<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.players.forEach((_,i) =&gt; {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td=document.createElement('td');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.className='center num';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>td.textContent = m.fmt(vByP[i][m.key]);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>tr.appendChild(td);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tb.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>table.appendChild(tb);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>body.appendChild(table);<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const footer=document.createElement('div'); footer.className='modal-footer';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const backBtn=document.createElement('button'); backBtn.className='btn'; backBtn.textContent='Back';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>backBtn.onclick = () =&gt; overlay.remove();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>footer.appendChild(backBtn);<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.append(title,body,footer);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.appendChild(modal);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.body.appendChild(overlay);<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.tabIndex=0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.focus();<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('click',e=&gt;{ if(e.target===overlay) overlay.remove(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('keydown',e=&gt;{ if(e.key==='Escape') overlay.remove(); });</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function openHighScoresDialog(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const overlay=document.createElement('div'); overlay.className='modal-backdrop';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal=document.createElement('div'); modal.className='modal';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const title=document.createElement('h3'); title.textContent='High Scores (Official)';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body=document.createElement('div'); body.className='modal-body';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const list = await cloudListHighScores(false, 50);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(!list.length){ const p=document.createElement('p'); p.textContent='No high scores yet.'; body.appendChild(p); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const table=document.createElement('table'); table.className='hs-table';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const thead=document.createElement('thead'); const trh=document.createElement('tr');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>['#','Player','Score','When'].forEach(h=&gt;{ const th=document.createElement('th'); th.textContent=h; trh.appendChild(th);}); thead.appendChild(trh); table.appendChild(thead);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const tb=document.createElement('tbody');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>list.forEach((row,idx)=&gt;{ const tr=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td1=document.createElement('td'); td1.textContent=String(idx+1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td2=document.createElement('td'); td2.textContent=row.name;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td3=document.createElement('td'); td3.textContent=String(row.score);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td4=document.createElement('td'); td4.textContent=new Date(row.ts).toLocaleString();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tr.append(td1,td2,td3,td4); tb.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>table.appendChild(tb); body.appendChild(table);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}catch(err){ console.error(err); const p=document.createElement('p'); p.textContent='Failed to load high scores.'; body.appendChild(p); }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const footer=document.createElement('div'); footer.className='modal-footer';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const closeBtn=document.createElement('button'); closeBtn.className='btn'; closeBtn.textContent='Close'; closeBtn.onclick=()=&gt;overlay.remove(); footer.appendChild(closeBtn);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.append(title,body,footer); overlay.appendChild(modal); document.body.appendChild(overlay); modal.tabIndex=0; modal.focus();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('click',e=&gt;{ if(e.target===overlay) overlay.remove();}); overlay.addEventListener('keydown',e=&gt;{ if(e.key==='Escape') overlay.remove();});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function openHighScoresDialogSP(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const overlay=document.createElement('div'); overlay.className='modal-backdrop';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal=document.createElement('div'); modal.className='modal';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const title=document.createElement('h3'); title.textContent='High Scores (Single Player)';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body=document.createElement('div'); body.className='modal-body';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const list = await cloudListHighScores(true, 50);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(!list.length){ const p=document.createElement('p'); p.textContent='No high scores yet.'; body.appendChild(p); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const table=document.createElement('table'); table.className='hs-table';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const thead=document.createElement('thead'); const trh=document.createElement('tr');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>['#','Player','Score','When'].forEach(h=&gt;{ const th=document.createElement('th'); th.textContent=h; trh.appendChild(th);}); thead.appendChild(trh); table.appendChild(thead);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const tb=document.createElement('tbody');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>list.forEach((row,idx)=&gt;{ const tr=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td1=document.createElement('td'); td1.textContent=String(idx+1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td2=document.createElement('td'); td2.textContent=row.name;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td3=document.createElement('td'); td3.textContent=String(row.score);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td4=document.createElement('td'); td4.textContent=new Date(row.ts).toLocaleString();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tr.append(td1,td2,td3,td4); tb.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>table.appendChild(tb); body.appendChild(table);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}catch(err){ console.error(err); const p=document.createElement('p'); p.textContent='Failed to load high scores.'; body.appendChild(p); }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const footer=document.createElement('div'); footer.className='modal-footer';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const closeBtn=document.createElement('button'); closeBtn.className='btn'; closeBtn.textContent='Close'; closeBtn.onclick=()=&gt;overlay.remove(); footer.appendChild(closeBtn);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.append(title,body,footer); overlay.appendChild(modal); document.body.appendChild(overlay); modal.tabIndex=0; modal.focus();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('click',e=&gt;{ if(e.target===overlay) overlay.remove();}); overlay.addEventListener('keydown',e=&gt;{ if(e.key==='Escape') overlay.remove();});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function openGameScoresDialog(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const overlay=document.createElement('div'); overlay.className='modal-backdrop';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal=document.createElement('div'); modal.className='modal';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const title=document.createElement('h3'); title.textContent='Game Scores';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body=document.createElement('div'); body.className='modal-body';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const table=document.createElement('table'); table.className='hs-table';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const thead=document.createElement('thead'); const trh=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>trh.appendChild(Object.assign(document.createElement('th'),{textContent:'Round'}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.players.forEach(p=&gt; trh.appendChild(Object.assign(document.createElement('th'),{textContent:p.name})));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>thead.appendChild(trh); table.appendChild(thead);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const tb=document.createElement('tbody');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let r=0;r&lt;MAX_ROUNDS;r++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const tr=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const rLabel=(ROUNDS[r].type==='number')?`${ROUNDS[r].target}s`:(ROUNDS[r].type==='doubles'?'Doubles':ROUNDS[r].type==='triples'?'Triples':'Bull');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tr.appendChild(Object.assign(document.createElement('th'),{textContent:rLabel,className:'stats-th'}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(let p=0;p&lt;state.players.length;p++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const pts=state.score[p][r].roundTotal||0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td=document.createElement('td'); td.className='center num'; td.textContent=String(pts); tr.appendChild(td);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>tb.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const trTot=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>trTot.appendChild(Object.assign(document.createElement('th'),{textContent:'Total',className:'stats-th'}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let p=0;p&lt;state.players.length;p++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const td=document.createElement('td'); td.className='center num'; td.textContent=String(totalScoreForPlayer(p)); trTot.appendChild(td);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>tb.appendChild(trTot); table.appendChild(tb); body.appendChild(table);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const footer=document.createElement('div'); footer.className='modal-footer';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const closeBtn=document.createElement('button'); closeBtn.className='btn'; closeBtn.textContent='Close'; closeBtn.onclick=()=&gt;overlay.remove(); footer.appendChild(closeBtn);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.append(title,body,footer); overlay.appendChild(modal); document.body.appendChild(overlay);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.tabIndex=0; modal.focus();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('click',e=&gt;{ if(e.target===overlay) overlay.remove();});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('keydown',e=&gt;{ if(e.key==='Escape') overlay.remove();});</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function openGameRaceDialog(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const overlay=document.createElement('div'); overlay.className='modal-backdrop';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal=document.createElement('div'); modal.className='modal';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const title=document.createElement('h3'); title.textContent='Race';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body=document.createElement('div'); body.className='modal-body';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const legend=document.createElement('div'); legend.style.display='flex'; legend.style.flexWrap='wrap'; legend.style.gap='10px'; legend.style.marginBottom='8px';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.players.forEach(p=&gt;{ const chip=document.createElement('span'); chip.textContent=p.name; chip.style.color=p.color; chip.style.fontWeight='800'; legend.appendChild(chip); });<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>body.appendChild(legend);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const canvas=document.createElement('canvas'); canvas.width=600; canvas.height=300; body.appendChild(canvas);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const footer=document.createElement('div'); footer.className='modal-footer';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const backBtn=document.createElement('button'); backBtn.className='btn'; backBtn.textContent='Back'; backBtn.onclick=()=&gt;overlay.remove(); footer.appendChild(backBtn);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.append(title,body,footer); overlay.appendChild(modal); document.body.appendChild(overlay);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.tabIndex=0; modal.focus();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('click',e=&gt;{ if(e.target===overlay) overlay.remove();});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('keydown',e=&gt;{ if(e.key==='Escape') overlay.remove();});<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const data=generateChartData();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>drawLineChart(canvas,data,{labelEnds:true});<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function getAllTimeHighScore() {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Prefer league table max of both tables combined as "all-time"</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return null; // omit to keep chart clean (or implement a combined fetch if desired)</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function generateChartData(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const labels=[]; for(let r=0;r&lt;MAX_ROUNDS;r++){ labels.push(ROUNDS[r].type==='number'?`${ROUNDS[r].target}s`:(ROUNDS[r].type==='doubles'?'Doubles':ROUNDS[r].type==='triples'?'Triples':'Bull')); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const datasets=[];<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let p=0;p&lt;state.players.length;p++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const playerData=[]; let run=0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(let r=0;r&lt;MAX_ROUNDS;r++){ run+=state.score[p][r].roundTotal||0; playerData.push(run); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>datasets.push({label:state.players[p].name, data:playerData, color:state.players[p].color});<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return {labels,datasets};<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function drawLineChart(canvas,data,opts={}){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const ctx=canvas.getContext('2d'); const W=canvas.width,H=canvas.height;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>ctx.clearRect(0,0,W,H);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const pad=40,cw=W-2*pad,ch=H-2*pad;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let max=0; data.datasets.forEach(ds=&gt;{ max=Math.max(max,...ds.data); }); max=Math.max(10,max||10);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>ctx.strokeStyle='#2a2e48'; ctx.lineWidth=1;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;=5;i++){ const y=pad+(ch*i/5); ctx.beginPath(); ctx.moveTo(pad,y); ctx.lineTo(pad+cw,y); ctx.stroke(); ctx.fillStyle='#a8acc3'; ctx.font='12px system-ui'; ctx.textAlign='right'; ctx.textBaseline='middle'; ctx.fillText(String(Math.round(max*(5-i)/5)), pad-8,y); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let i=0;i&lt;data.labels.length;i++){ const x=pad+(cw*i/(data.labels.length-1)); ctx.beginPath(); ctx.moveTo(x,pad); ctx.lineTo(x,pad+ch); ctx.stroke(); ctx.fillStyle='#a8acc3'; ctx.font='10px system-ui'; ctx.textAlign='center'; ctx.textBaseline='top'; ctx.fillText(data.labels[i], x, pad+ch+4); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>data.datasets.forEach(ds=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ctx.beginPath(); ctx.lineWidth=3; ctx.strokeStyle=ds.color;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(let i=0;i&lt;ds.data.length;i++){ const x=pad+(cw*i/(data.labels.length-1)); const y=pad+ch-(ch*ds.data[i]/max); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); } ctx.stroke();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>ctx.fillStyle=ds.color;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(let i=0;i&lt;ds.data.length;i++){ const x=pad+(cw*i/(data.labels.length-1)); const y=pad+ch-(ch*ds.data[i]/max); ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill(); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(opts.labelEnds){ const i=ds.data.length-1; const x=pad+(cw*i/(data.labels.length-1)); const y=pad+ch-(ch*ds.data[i]/max); ctx.font='12px system-ui'; ctx.textAlign='left'; ctx.textBaseline='middle'; ctx.fillStyle=ds.color; ctx.fillText('<span class="Apple-converted-space">Â  </span>'+ds.label, Math.min(x+6, W-80), y); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/* &gt;&gt;&gt; INSERT THESE TWO NEW FUNCTIONS &lt;&lt;&lt; */</p>
<p class="p1">function recordThrow(spec){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Ignore input if game is finished or in sudden death</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (state.finished || state.suddenDeath.active) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const rIndex<span class="Apple-converted-space">Â  Â  </span>= state.currentRound;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const pIndex<span class="Apple-converted-space">Â  Â  </span>= state.currentPlayer;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const dartIndex = state.currentDart;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (rIndex &lt; 0 || rIndex &gt;= MAX_ROUNDS) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (pIndex &lt; 0 || pIndex &gt;= state.players.length) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (dartIndex &lt; 0 || dartIndex &gt; 2) return;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const roundDef = ROUNDS[rIndex];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const entry<span class="Apple-converted-space">Â  Â  </span>= state.score[pIndex][rIndex];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let points = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let hitKey = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let dartObj;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (spec.kind === 'Miss') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>dartObj = { kind: 'Miss', points: 0 };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} else if (roundDef.type === 'number') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const base = roundDef.target;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (spec.kind === 'S')<span class="Apple-converted-space">Â  Â  Â  </span>points = base;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else if (spec.kind === 'D') points = base * 2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>else if (spec.kind === 'T') points = base * 3;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>dartObj = { kind: spec.kind, points };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>hitKey<span class="Apple-converted-space">Â  </span>= String(base);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} else if (roundDef.type === 'doubles' || roundDef.type === 'triples') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const sector = spec.sector || 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (!sector) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>dartObj = { kind: 'Miss', points: 0 };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const mult = roundDef.type === 'doubles' ? 2 : 3;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>points = sector * mult;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>dartObj = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>kind: roundDef.type === 'doubles' ? 'Double' : 'Triple',</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sector,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>points</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>hitKey = String(sector);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} else if (roundDef.type === 'bull') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const bull = spec.bull || 'Outer';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>points = bull === 'Inner' ? 50 : 25;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>dartObj = { kind: 'Bull', bull, points };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>hitKey<span class="Apple-converted-space">Â  </span>= 'Bull';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>dartObj = { kind: 'Miss', points: 0 };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Write dart</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>entry.darts[dartIndex] = dartObj;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>entry.roundTotal =</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>(entry.darts[0]?.points || 0) +</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>(entry.darts[1]?.points || 0) +</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>(entry.darts[2]?.points || 0);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// History (for Undo)</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.history.push({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>player:<span class="Apple-converted-space">Â  Â  </span>pIndex,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>round: <span class="Apple-converted-space">Â  Â  </span>rIndex,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>dartIndex: dartIndex,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>throw: <span class="Apple-converted-space">Â  Â  </span>dartObj</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Match aggregates</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>ensureMatchAgg();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (hitKey &amp;&amp; points &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const hitsMap =</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.matchAgg.hits[pIndex] ||</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>(state.matchAgg.hits[pIndex] = {});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>hitsMap[hitKey] = (hitsMap[hitKey] || 0) + 1;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Recompute 60+/100+/140+ for this player</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>recomputeMatchAggTotalsForPlayer(pIndex);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Advance dart / player / round</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (state.currentDart &lt; 2) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.currentDart++;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.currentDart = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (state.currentPlayer &lt; state.players.length - 1) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.currentPlayer++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.currentPlayer = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (state.currentRound &lt; MAX_ROUNDS - 1) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.currentRound++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// Game done. Interval will open the finish modal.</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.finished = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateUI();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function recomputeMatchAggTotalsForPlayer(pIdx){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>ensureMatchAgg();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let c60 = 0, c100 = 0, c140 = 0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for (let r = 0; r &lt; MAX_ROUNDS; r++) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const rt =</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>state.score?.[pIdx]?.[r]?.roundTotal ||</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (rt &gt;= 60)<span class="Apple-converted-space">Â  </span>c60++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (rt &gt;= 100) c100++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (rt &gt;= 140) c140++;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.matchAgg.totals60[pIdx]<span class="Apple-converted-space">Â  </span>= c60;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.matchAgg.totals100[pIdx] = c100;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.matchAgg.totals140[pIdx] = c140;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â </span>setInterval(()=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(document.body.getAttribute('data-page')==='game' &amp;&amp; state &amp;&amp; state.finished &amp;&amp; !__finishModalOpen) openFinishModal();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}catch(e){}</p>
<p class="p1">}, 600);</p>
<p class="p2"><br></p>
<p class="p1">async function recordGameToHighScores(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const ts=Date.now();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (state.players.length &gt; 1) {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for(let i=0;i&lt;state.players.length;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const name = state.players[i].name;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const score = totalScoreForPlayer(i);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>await cloudInsertHighScore(name, score, false);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else if (state.players.length === 1) {<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const name = state.players[0].name;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const score = totalScoreForPlayer(0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>await cloudInsertHighScore(name, score, true);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}catch(err){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>console.error(err);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Fallback store locally so you don't lose the score</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const key = (state.players.length===1) ? HS_KEY_SP : HS_KEY;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const arr = safeLoad(key) || [];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(state.players.length&gt;1){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for(let i=0;i&lt;state.players.length;i++){ arr.push({ name: state.players[i].name, score: totalScoreForPlayer(i), ts }); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>} else { arr.push({ name: state.players[0].name, score: totalScoreForPlayer(0), ts }); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>safeSave(key, arr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>toast('Cloud save failed â€” stored locally');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Stub so finishing a game doesn't explode if full game logging isn't wired yet.</p>
<p class="p1">async function recordFullGameToSupabase(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// If/when you want to log full per-dart games to Supabase,</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// implement it here. For now it's intentionally a no-op.</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>return;</p>
<p class="p1">}</p>
<p class="p1">async function awardAndShowLeaderboard(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const totals = state.players.map((_,i)=&gt; totalScoreForPlayer(i));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const max = Math.max(...totals);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const winners = totals.map((t,i)=&gt; t===max?i:null).filter(x=&gt;x!==null);<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Ensure wins array is sane</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!state.match.wins || state.match.wins.length!==state.players.length){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.match.wins = Array.from({length:state.players.length},()=&gt;0);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Bump wins + store per-game totals</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>winners.forEach(i=&gt;state.match.wins[i]++);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Deep-clone current scoreboard so we can do match-wide stats later</p>
<p class="p1">const boardClone = JSON.parse(JSON.stringify(state.score));</p>
<p class="p2"><br></p>
<p class="p1">state.match.history.push({</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>totals: totals.slice(),</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>board:<span class="Apple-converted-space">Â  </span>boardClone</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Full game â†’ Supabase</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>await recordFullGameToSupabase();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>console.error(e);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>toast('Game saved to local only (cloud failed)');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// High scores â†’ Supabase (+ your local fallback)</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>try {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>await recordGameToHighScores();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>} catch (e) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>console.error(e);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(state.match.gameNumber &lt; state.match.totalGames) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.match.gameNumber += 1;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>save();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>showLeaderboard();<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">const lbTable=byId('lbTable'); const lbTHead=lbTable.querySelector('thead'); const lbTBody=lbTable.querySelector('tbody');</p>
<p class="p1">const lbMatchInfo=byId('lbMatchInfo'); const nextGameBtn=byId('nextGameBtn'); const gameScoresBtn=byId('gameScoresBtn'); const newMatchBtn=byId('newMatchBtn'); const gamesRemainTag=byId('gamesRemainTag');</p>
<p class="p1">function updateLeaderboardTable(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>lbTHead.innerHTML=''; lbTBody.innerHTML='';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const trh=document.createElement('tr'); trh.appendChild(Object.assign(document.createElement('th'),{textContent:'Player'}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>for(let g=0; g&lt;state.match.totalGames; g++){ const th=document.createElement('th'); th.textContent='G'+(g+1); trh.appendChild(th); }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>trh.appendChild(Object.assign(document.createElement('th'),{textContent:'Match Total'}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>trh.appendChild(Object.assign(document.createElement('th'),{textContent:'Game Wins'}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>lbTHead.appendChild(trh);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.players.forEach((player, idx)=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const tr=document.createElement('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const nameTd=document.createElement('td'); nameTd.textContent=player.name; nameTd.style.color=player.color; tr.appendChild(nameTd);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let matchTotal=0;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(let g=0; g&lt;state.match.totalGames; g++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const td=document.createElement('td'); td.className='center';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const t=(state.match.history[g]?.totals?.[idx])||0; td.textContent=String(t); matchTotal+=t; tr.appendChild(td);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const totalTd=document.createElement('td'); totalTd.className='center'; totalTd.textContent=String(matchTotal); tr.appendChild(totalTd);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const winsTd=document.createElement('td'); winsTd.className='center'; winsTd.textContent=String(state.match.wins[idx]||0); tr.appendChild(winsTd);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>lbTBody.appendChild(tr);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">function showLeaderboard(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>show('leaderboard');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateLeaderboardTable();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const completedGames=Math.min(state.match.history.length, state.match.totalGames);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const remaining=Math.max(0, state.match.totalGames - completedGames);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>lbMatchInfo.textContent=`Completed: ${completedGames} / ${state.match.totalGames} â€¢ Remaining: ${remaining}`;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>gamesRemainTag.textContent=remaining+' remaining';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>nextGameBtn.disabled=(remaining===0);<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p1">nextGameBtn.addEventListener('click',()=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const completedGames = state.match.history.length;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const remaining = Math.max(0, state.match.totalGames - completedGames);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(remaining&lt;=0){ alert('Match complete! Start a new match from the details screen.'); return; }<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.finished=false;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.suddenDeath={active:false,participants:[],turnIndex:0,throws:[],round:1};<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const rot=completedGames % state.players.length;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>startNewGame(false);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.currentPlayer=rot;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>show('game');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updateUI();<span class="Apple-converted-space">Â </span></p>
<p class="p1">});</p>
<p class="p1">newMatchBtn.addEventListener('click',()=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!confirm('End current match and return to details?')) return;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>safeClear(STORAGE_KEY);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>Object.assign(state,{players:[],score:[],currentRound:0,currentPlayer:0,currentDart:0,history:[],finished:false,suddenDeath:{active:false,participants:[],turnIndex:0,throws:[],round:1}, match:{ totalGames:5, gameNumber:1, wins:[], history:[] }, matchAgg:null});<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>show('details');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updatePadSpacer();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>setupStartMenuButtons();<span class="Apple-converted-space">Â </span></p>
<p class="p1">});</p>
<p class="p1">gameScoresBtn.addEventListener('click', openGameScoresDialog);</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* SCROLL SYNC (keeps columns aligned)</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">let _scrollSyncSet=false;<span class="Apple-converted-space">Â </span></p>
<p class="p1">function setupScrollSync(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(_scrollSyncSet) return;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const sw=byId('scoreWrap'), st=byId('statsWrap'), fh=byId('floatWrap'), ms=byId('mstatsWrap');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!sw||!st||!fh||!ms) return;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>let syncing=false;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function mirror(from){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(syncing) return; syncing=true;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const x=from.scrollLeft; [sw,st,fh,ms].forEach(el=&gt;{ if(el!==from) el.scrollLeft=x; }); syncing=false;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>[sw,st,fh,ms].forEach(el=&gt; el.addEventListener('scroll',()=&gt;mirror(el),{passive:true}));<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>_scrollSyncSet=true;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>requestAnimationFrame(()=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const sRow=thead?.querySelector('tr'), tRow=statsThead?.querySelector('tr'), fRow=floatThead?.querySelector('tr');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if(!sRow||!tRow||!fRow) return;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const sCells=sRow.children, tCells=tRow.children, fCells=fRow.children;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const leftW=sCells[0].getBoundingClientRect().width;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>document.documentElement.style.setProperty('--left-col-w', leftW+'px');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const n=Math.min(sCells.length,tCells.length,fCells.length);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>for(let i=1;i&lt;n;i++){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const w=sCells[i].getBoundingClientRect().width;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>[tCells[i], fCells[i]].forEach(cell=&gt;{ if(cell){ cell.style.width=w+'px'; cell.style.minWidth=w+'px'; cell.style.maxWidth=w+'px'; } });<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* START/RESET + ORDER DIALOG</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">function buildEverything(){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>buildScoreHeader();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>buildScoreBody();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>buildFloatingHeader();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>buildStatsHeader();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>buildStatsBody();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>buildMatchStatsHeader();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>buildMatchStatsBody();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>setupScrollSync();<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">// Throw order selection</p>
<p class="p1">function showPlayerOrderDialog() {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const overlay = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.className = 'modal-backdrop';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.className = 'modal';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const title = document.createElement('h3'); title.textContent = 'Select Throwing Order';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body = document.createElement('div'); body.className = 'modal-body';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const instructions = document.createElement('p'); instructions.textContent = 'Use up/down buttons to set the throwing order:'; instructions.style.marginBottom='15px'; body.appendChild(instructions);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const playerList = document.createElement('div'); playerList.id='playerOrderList'; playerList.style.display='flex'; playerList.style.flexDirection='column'; playerList.style.gap='8px'; body.appendChild(playerList);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>function renderList(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>playerList.innerHTML='';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.players.forEach((player, index) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const item = document.createElement('div');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>item.className = 'player-order-item';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>item.dataset.index = index;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>item.innerHTML = `</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span style="background:${player.color}; color:white; padding:4px 8px; border-radius:4px; margin-right:8px;"&gt;${player.name.charAt(0)}&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>${player.name}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div style="margin-left: auto; display:flex; gap:4px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button class="btn small" data-action="up" data-index="${index}"&gt;â†‘&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button class="btn small" data-action="down" data-index="${index}"&gt;â†“&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>playerList.appendChild(item);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>playerList.querySelectorAll('button[data-action]').forEach(b=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>b.onclick = (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const idx = parseInt(e.currentTarget.dataset.index, 10);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const act = e.currentTarget.dataset.action;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (act === 'up' &amp;&amp; idx &gt; 0) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>swapPlayers(idx, idx - 1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>renderList();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (act === 'down' &amp;&amp; idx &lt; state.players.length - 1) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>swapPlayers(idx, idx + 1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>renderList();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>renderList();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const footer = document.createElement('div'); footer.className='modal-footer';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const cancelBtn = document.createElement('button'); cancelBtn.className='btn'; cancelBtn.textContent = 'Cancel'; cancelBtn.onclick = () =&gt; overlay.remove();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const confirmBtn = document.createElement('button'); confirmBtn.className='btn primary'; confirmBtn.textContent = 'Confirm Order';</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>confirmBtn.onclick = () =&gt; { overlay.remove(); startNewGame(true); };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>footer.append(cancelBtn,confirmBtn);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.append(title, body, footer); overlay.appendChild(modal); document.body.appendChild(overlay);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('click', e =&gt; { if (e.target === overlay) overlay.remove(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('keydown', e =&gt; { if (e.key === 'Escape') overlay.remove(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.tabIndex = 0; modal.focus();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function startNewGame(setOrder=false){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if(!setOrder){ showPlayerOrderDialog(); return; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.score = Array.from({length:state.players.length},()=&gt;Array.from({length:MAX_ROUNDS},()=&gt;({darts:[null,null,null],roundTotal:0})));</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.currentRound = 0; state.currentPlayer = 0; state.currentDart = 0; state.history = []; state.finished = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.suddenDeath = {active:false,participants:[],turnIndex:0,throws:[],round:1};</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>ensureMatchAgg();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>show('game'); buildEverything(); updateUI(); save();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function restartGame() {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (!confirm('Are you sure you want to restart this game? All progress will be lost.')) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.finished = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>state.suddenDeath = {active:false, participants:[], turnIndex:0, throws:[], round:1};</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>startNewGame();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>show('game'); updateUI();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">function swapPlayers(i, j) {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Swap players themselves</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>[state.players[i], state.players[j]] = [state.players[j], state.players[i]];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Swap match wins</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (state.match &amp;&amp; Array.isArray(state.match.wins)) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>[state.match.wins[i], state.match.wins[j]] =</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>[state.match.wins[j], state.match.wins[i]];</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Swap per-game totals already stored</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (state.match &amp;&amp; Array.isArray(state.match.history)) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>state.match.history.forEach(g =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (g &amp;&amp; Array.isArray(g.totals)) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>[g.totals[i], g.totals[j]] = [g.totals[j], g.totals[i]];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Swap matchAgg stats so favourites / 60+ / 100+ / 140+ stay with the player</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>if (state.matchAgg) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (Array.isArray(state.matchAgg.hits)) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>[state.matchAgg.hits[i], state.matchAgg.hits[j]] =</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>[state.matchAgg.hits[j], state.matchAgg.hits[i]];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>['totals60', 'totals100', 'totals140'].forEach(key =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (Array.isArray(state.matchAgg[key])) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>[state.matchAgg[key][i], state.matchAgg[key][j]] =</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>[state.matchAgg[key][j], state.matchAgg[key][i]];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1">}</p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* ADMIN HUB + ADMIN PANELS</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">function openAdminHub(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const hub = byId('adminHubModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>hub.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('openHsLeagueAdmin').onclick = ()=&gt;{ hub.classList.add('hidden'); openHighScoresAdminDialog(false); };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('openHsPracticeAdmin').onclick = ()=&gt;{ hub.classList.add('hidden'); openHighScoresAdminDialog(true); };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('openSavedPlayersAdmin').onclick = ()=&gt;{ hub.classList.add('hidden'); openSavedPlayersAdmin(); };</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('closeAdminHubBtn').onclick = ()=&gt; hub.classList.add('hidden');</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function openHighScoresAdminDialog(single=false){<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const overlay=document.createElement('div'); overlay.className='modal-backdrop';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modal=document.createElement('div'); modal.className='modal';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const title=document.createElement('h3'); title.textContent=`High Scores â€” Admin (${single?'Practice':'League'})`;<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body=document.createElement('div'); body.className='modal-body';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const footer=document.createElement('div'); footer.className='modal-footer';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>async function render(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>body.innerHTML='';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const list = await cloudListHighScores(single, 50);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(!list.length){ const p=document.createElement('p'); p.textContent='No high scores.'; body.appendChild(p); return; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const table=document.createElement('table'); table.className='hs-table compact';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const thead=document.createElement('thead'); const trh=document.createElement('tr');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>['#','Player','Score','When'].forEach(h=&gt;{ const th=document.createElement('th'); th.textContent=h; trh.appendChild(th);}); thead.appendChild(trh); table.appendChild(thead);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const tb=document.createElement('tbody');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>list.forEach((row,idx)=&gt;{<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tr=document.createElement('tr'); tr.style.cursor='pointer'; tr.title='Click to delete';<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td1=document.createElement('td'); td1.textContent=String(idx+1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td2=document.createElement('td'); td2.textContent=row.name;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td3=document.createElement('td'); td3.textContent=String(row.score);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const td4=document.createElement('td'); td4.textContent=new Date(row.ts).toLocaleString();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tr.append(td1,td2,td3,td4);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tr.onclick=async()=&gt;{ if(confirm(`Delete ${row.name} â€” ${row.score}?`)){ try{ await cloudDeleteHighScore(row, single); await render(); }catch(e){ console.error(e); toast('Delete failed'); } } };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tb.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>table.appendChild(tb); body.appendChild(table);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}catch(err){ console.error(err); const p=document.createElement('p'); p.textContent='Failed to load.'; body.appendChild(p); }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>await render();</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const closeBtn=document.createElement('button'); closeBtn.className='btn'; closeBtn.textContent='Exit'; closeBtn.onclick=()=&gt;overlay.remove(); footer.appendChild(closeBtn);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.append(title,body,footer); overlay.appendChild(modal); document.body.appendChild(overlay);<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('click', e=&gt;{ if(e.target===overlay) overlay.remove(); });</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>overlay.addEventListener('keydown', e=&gt;{ if(e.key==='Escape') overlay.remove(); });<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modal.tabIndex=0; modal.focus();<span class="Apple-converted-space">Â </span></p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">async function openSavedPlayersAdmin(){</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const modalWrap = byId('savedPlayersAdminModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>const body = byId('savedPlayersAdminBody');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>modalWrap.classList.remove('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('closeSavedPlayersAdminBtn').onclick = ()=&gt; modalWrap.classList.add('hidden');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>async function render(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>body.innerHTML='';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>try{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const list = await cloudListPlayers();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if(!list.length){ body.innerHTML = '&lt;p&gt;No players saved.&lt;/p&gt;'; return; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const table = document.createElement('table'); table.className='hs-table compact';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const thead=document.createElement('thead'); const trh=document.createElement('tr');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>['Player','Actions'].forEach(h=&gt;{ const th=document.createElement('th'); th.textContent=h; trh.appendChild(th); }); thead.appendChild(trh); table.appendChild(thead);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const tb=document.createElement('tbody');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>list.forEach(row=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tr=document.createElement('tr');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tdName=document.createElement('td'); tdName.textContent=row.name; tr.appendChild(tdName);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tdAct=document.createElement('td'); tdAct.className='center';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const editBtn=document.createElement('button'); editBtn.className='btn small'; editBtn.textContent='Set Password';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>editBtn.onclick=async()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const np = prompt(`New password for ${row.name}:`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if(!np) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>try{ await cloudUpdatePlayerPassword(row.name, np); toast('Updated'); }catch(e){ console.error(e); toast('Update failed'); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const delBtn=document.createElement('button'); delBtn.className='btn small danger'; delBtn.textContent='Delete';</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>delBtn.onclick=async()=&gt;{ if(confirm(`Delete player ${row.name}?`)){ try{ await cloudDeletePlayer(row.name); await render(); }catch(e){ console.error(e); toast('Delete failed'); } } };</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tdAct.append(editBtn,' ',delBtn); tr.appendChild(tdAct); tb.appendChild(tr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>table.appendChild(tb); body.appendChild(table);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}catch(err){ console.error(err); body.innerHTML='&lt;p&gt;Failed to load players.&lt;/p&gt;'; }</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>await render();</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/*****************</p>
<p class="p1"><span class="Apple-converted-space">Â </span>* BOOT</p>
<p class="p1"><span class="Apple-converted-space">Â </span>*****************/</p>
<p class="p1">document.addEventListener('DOMContentLoaded', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>show('details');<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>updatePadSpacer();<span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>setupStartMenuButtons();<span class="Apple-converted-space">Â </span></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Default draw PS rows</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>drawPsRows();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Kick off initial cloud connectivity check</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>initialCloudCheck();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Restart buttons</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('restartGameBtn').onclick = restartGame;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>byId('restartGameBtnLB').onclick = restartGame;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>// Global ESC/click-outside for add/select modals</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.addEventListener('click', function(event) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const addPlayerModal = document.getElementById('addPlayerModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const selectPlayerModal = document.getElementById('selectPlayerModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (addPlayerModal &amp;&amp; !addPlayerModal.classList.contains('hidden') &amp;&amp;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>event.target === addPlayerModal) {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>addPlayerModal.classList.add('hidden');</p>
<p class="p1">}</p>
<p class="p1">if (selectPlayerModal &amp;&amp; !selectPlayerModal.classList.contains('hidden') &amp;&amp;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>event.target === selectPlayerModal) {</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>selectPlayerModal.classList.add('hidden');</p>
<p class="p1">}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>document.addEventListener('keydown', function(event) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (event.key === 'Escape') {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const addPlayerModal = document.getElementById('addPlayerModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const selectPlayerModal = document.getElementById('selectPlayerModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const adminHub = document.getElementById('adminHubModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const savedPlayersAdmin = document.getElementById('savedPlayersAdminModal');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (addPlayerModal &amp;&amp; !addPlayerModal.classList.contains('hidden')) addPlayerModal.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (selectPlayerModal &amp;&amp; !selectPlayerModal.classList.contains('hidden')) selectPlayerModal.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (adminHub &amp;&amp; !adminHub.classList.contains('hidden')) adminHub.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (savedPlayersAdmin &amp;&amp; !savedPlayersAdmin.classList.contains('hidden')) savedPlayersAdmin.classList.add('hidden');</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>});</p>
<p class="p1">});</p>
<p class="p1">&lt;/script&gt;</p>
</body>
</html>
